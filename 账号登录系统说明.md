# 账号登录系统更新说明

## 🎉 更新内容

已成功将同步码系统升级为**账号登录系统**，实现了以下功能：

### ✨ 主要功能

1. **账号注册与登录**
   - 使用邮箱和密码进行注册
   - 安全的账号登录系统
   - 密码至少6位要求

2. **记住密码功能**
   - 勾选"记住账号密码"后，下次打开自动登录
   - 避免同一浏览器频繁登录
   - 安全的本地存储

3. **账号互通**
   - 每个账号独立，数据完全隔离
   - 不同账号互不影响
   - 使用相同账号密码在任何设备登录都能访问同一份数据

4. **自动同步**
   - 登录后自动从云端下载数据
   - 每次操作（添加、修改、删除记录）都自动上传到云端
   - 实时监听云端数据变化，自动同步到本地
   - 多设备同时使用时数据自动保持一致

5. **新设备/浏览器使用**
   - 首次打开需要登录或注册
   - 登录后自动同步所有数据
   - 支持"记住密码"避免重复登录

## 🔧 配置要求

### 重要：需要启用 Firebase Authentication

当前代码使用的 Firebase 配置需要启用 Authentication 功能。请按以下步骤操作：

#### 1. 登录 Firebase Console

访问：https://console.firebase.google.com/
找到项目：`zbzawjq-keshijisuan`

#### 2. 启用 Authentication

1. 在左侧菜单点击 **"Authentication"**
2. 点击 **"Get started"** 或 **"开始使用"**
3. 在 **"Sign-in method"**（登录方法）标签页中
4. 点击 **"Email/Password"**（电子邮件/密码）
5. 启用 **"Email/Password"** 选项
6. 点击 **"Save"**（保存）

#### 3. 更新 Firestore 安全规则

在 Firestore 数据库中，将安全规则更新为：

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 用户数据规则：只有已登录用户可以访问自己的数据
    match /userData/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 如果需要兼容旧的同步码系统（可选）
    match /salaryData/{document=**} {
      allow read, write: if true;
    }
  }
}
```

**重要**：上述规则确保：
- 每个用户只能访问自己的数据（通过 `userId` 进行隔离）
- 必须登录才能读写数据
- 不同账号的数据完全隔离，互不影响

## 📱 使用方法

### 新用户

1. 打开应用
2. 点击右上角"登录"按钮
3. 点击"立即注册"
4. 输入邮箱和密码（至少6位）
5. 确认密码
6. 点击"注册"按钮
7. 注册成功后自动登录并上传本地数据到云端

### 老用户

1. 打开应用
2. 点击右上角"登录"按钮
3. 输入邮箱和密码
4. 勾选"记住账号密码"（可选）
5. 点击"登录"按钮
6. 登录成功后自动从云端下载数据

### 多设备同步

1. 在第一台设备上注册并使用
2. 在第二台设备上使用相同的账号密码登录
3. 数据会自动同步
4. 任一设备的修改都会实时同步到其他设备

### 退出登录

1. 点击右上角用户按钮
2. 点击"退出登录"
3. 退出后数据停止同步，但本地数据保留

## 🔒 安全性说明

1. **密码安全**：密码通过 Firebase Authentication 加密存储，非常安全
2. **数据隔离**：每个账号的数据完全独立，其他人无法访问
3. **记住密码**：密码加密存储在本地浏览器，仅当前浏览器可访问
4. **云端存储**：数据存储在 Google Firebase 服务器，安全可靠

## ⚠️ 注意事项

1. **邮箱要求**：必须是有效的邮箱格式
2. **密码要求**：至少6位字符
3. **数据备份**：建议定期导出Excel备份数据
4. **记住密码**：仅在个人设备上勾选"记住密码"
5. **网络需求**：需要网络连接才能同步数据

## 🆚 与旧系统的区别

| 功能 | 旧系统（同步码） | 新系统（账号登录） |
|------|----------------|------------------|
| 身份验证 | 简单同步码 | 邮箱密码 |
| 数据隔离 | 通过哈希，不够安全 | 基于用户ID，完全隔离 |
| 自动登录 | 不支持 | 支持"记住密码" |
| 同步时机 | 手动设置 | 登录时自动同步 |
| 实时同步 | 基础实时监听 | 完整实时同步 |
| 安全性 | 较低 | 高（Firebase Auth） |

## 🐛 故障排除

### 问题1：无法注册
- 检查邮箱格式是否正确
- 确认密码至少6位
- 检查 Firebase Authentication 是否已启用

### 问题2：无法登录
- 检查账号密码是否正确
- 确认网络连接正常
- 尝试清除浏览器缓存后重新登录

### 问题3：数据没有同步
- 确认已成功登录（右上角显示用户邮箱）
- 检查网络连接
- 查看浏览器控制台是否有错误信息
- 尝试退出登录后重新登录

### 问题4：提示 Firebase 错误
- 确认 Firebase Authentication 已启用
- 检查 Firestore 安全规则是否正确配置
- 确认网络可以访问 Firebase 服务

## 📞 技术支持

如遇问题：
1. 查看浏览器控制台（F12）的错误信息
2. 检查 Firebase Console 的 Authentication 和 Firestore 配置
3. 参考 `FIREBASE_CONFIG.md` 文件

---

**更新时间**：2025-11-08
**版本**：v2.0 - 账号登录系统
